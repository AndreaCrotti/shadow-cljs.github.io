<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Thomas Heller and Tony Kay">
<title>Shadow CLJS User&#8217;s Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Shadow CLJS User&#8217;s Guide</h1>
<div class="details">
<span id="author" class="author">Thomas Heller and Tony Kay</span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">Jan 10, 2018</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_why_shadow_cljs">1.1. Why shadow-cljs?</a></li>
<li><a href="#_conventions_used_in_this_book">1.2. Conventions Used in this Book</a></li>
</ul>
</li>
<li><a href="#_quick_start">2. Quick Start</a>
<ul class="sectlevel2">
<li><a href="#_installing_the_tools">2.1. Installing the Tools</a></li>
<li><a href="#_running_code_shadow_cljs_code">2.2. Running <code>shadow-cljs</code></a>
<ul class="sectlevel3">
<li><a href="#_server_mode">2.2.1. Server Mode</a></li>
</ul>
</li>
<li><a href="#_build_tool_integration">2.3. Build Tool Integration</a>
<ul class="sectlevel3">
<li><a href="#Leiningen">2.3.1. Leiningen Integration</a></li>
<li><a href="#_boot">2.3.2. Boot</a></li>
</ul>
</li>
<li><a href="#_embedding">2.4. Embedding</a></li>
</ul>
</li>
<li><a href="#_configuration">3. Configuration</a>
<ul class="sectlevel2">
<li><a href="#_build_targets">3.1. Build Targets</a></li>
<li><a href="#_compilation">3.2. Compilation</a></li>
<li><a href="#CommonConfig">3.3. Main Configuration</a>
<ul class="sectlevel3">
<li><a href="#_code_source_paths_code">3.3.1. <code>:source-paths</code></a></li>
<li><a href="#_code_builds_code">3.3.2. <code>:builds</code></a></li>
</ul>
</li>
<li><a href="#_server_options">3.4. Server Options</a>
<ul class="sectlevel3">
<li><a href="#nREPL">3.4.1. nREPL</a></li>
<li><a href="#_http">3.4.2. HTTP</a></li>
<li><a href="#_ssl">3.4.3. SSL</a></li>
</ul>
</li>
<li><a href="#_development_options">3.5. Development Options</a>
<ul class="sectlevel3">
<li><a href="#_preloads">3.5.1. Preloads</a></li>
<li><a href="#_hot_code_reload">3.5.2. Hot Code Reload</a></li>
<li><a href="#_lifecycle_hooks">3.5.3. Lifecycle Hooks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#UsingNPMModules">4. Using JavaScript Dependencies</a>
<ul class="sectlevel2">
<li><a href="#_installing_js_dependencies">4.1. Installing JS Dependencies</a></li>
<li><a href="#_using_js_dependencies">4.2. Using JS Dependencies</a></li>
<li><a href="#_resolving_js_dependencies">4.3. Resolving JS Dependencies</a>
<ul class="sectlevel3">
<li><a href="#_using_a_cdn">4.3.1. Using a CDN</a></li>
<li><a href="#_redirecting_require">4.3.2. Redirecting “require”</a></li>
<li><a href="#_using_local_files">4.3.3. Using local Files</a></li>
</ul>
</li>
<li><a href="#_migrating_cljsjs">4.4. Migrating cljsjs.*</a></li>
</ul>
</li>
<li><a href="#BrowserTarget">5. Targeting the Browser</a>
<ul class="sectlevel2">
<li><a href="#_output_settings">5.1. Output Settings</a></li>
<li><a href="#_modules">5.2. Modules</a></li>
<li><a href="#_http_server">5.3. HTTP Server</a>
<ul class="sectlevel3">
<li><a href="#_development_http_and_uri_based_routing_push_state">5.3.1. Development HTTP and URI-based Routing (Push state)</a></li>
</ul>
</li>
<li><a href="#_web_workers">5.4. Web Workers</a></li>
<li><a href="#CodeSplitting">5.5. Code Splitting</a>
<ul class="sectlevel3">
<li><a href="#_using_shadow_cljs_s_built_in_loader_support">5.5.1. Using shadow-cljs&#8217;s built-in Loader Support</a></li>
<li><a href="#_using_the_standard_clojurescript_api">5.5.2. Using the Standard ClojureScript API</a></li>
</ul>
</li>
<li><a href="#NameHashing">5.6. Hashed Module Names</a>
<ul class="sectlevel3">
<li><a href="#_hashed_file_manifest">5.6.1. Hashed File Manifest</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_targeting_node">6. Targeting Node</a>
<ul class="sectlevel2">
<li><a href="#_node_scripts">6.1. Node Scripts</a>
<ul class="sectlevel3">
<li><a href="#_build_options">6.1.1. Build Options</a></li>
<li><a href="#NodeHotCodeReload">6.1.2. Hot Code Reload</a></li>
</ul>
</li>
<li><a href="#NodeLibrary">6.2. Node Libraries</a>
<ul class="sectlevel3">
<li><a href="#_exports">6.2.1. Exports</a></li>
<li><a href="#_full_example">6.2.2. Full Example</a></li>
</ul>
</li>
<li><a href="#_distributing_on_npm">6.3. Distributing on NPM</a></li>
</ul>
</li>
<li><a href="#_testing">7. Testing</a>
<ul class="sectlevel2">
<li><a href="#_browser_test">7.1. Browser Test</a>
<ul class="sectlevel3">
<li><a href="#_generated_output_in_code_test_dir_code">7.1.1. Generated output in <code>:test-dir</code></a></li>
</ul>
</li>
<li><a href="#_targeting_tests_to_karma_for_continuous_integration">7.2. Targeting Tests to Karma for Continuous Integration</a>
<ul class="sectlevel3">
<li><a href="#_installing_karma">7.2.1. Installing Karma</a></li>
<li><a href="#_the_build">7.2.2. The Build</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_embedding_in_the_js_ecosystem_the_code_node_module_code_target">8. Embedding in the JS Ecosystem&#8201;&#8212;&#8201;The <code>:node-module</code> Target</a>
<ul class="sectlevel2">
<li><a href="#_convenience_mode">8.1. Convenience Mode</a></li>
<li><a href="#_explicit_configuration">8.2. Explicit Configuration</a></li>
<li><a href="#_working_with_optimizations">8.3. Working with Optimizations</a></li>
</ul>
</li>
<li><a href="#_generating_production_code_all_targets">9. Generating Production Code&#8201;&#8212;&#8201;All Targets</a>
<ul class="sectlevel2">
<li><a href="#Optimization">9.1. Optimizations</a></li>
<li><a href="#_release_specific_vs_development_configuration">9.2. Release-Specific vs. Development Configuration</a></li>
</ul>
</li>
<li><a href="#_custom_targets">10. Custom Targets</a>
<ul class="sectlevel2">
<li><a href="#_example">10.1. Example</a></li>
<li><a href="#_compilation_stages">10.2. Compilation Stages</a></li>
</ul>
</li>
<li><a href="#_editor_ide_repl_setup">11. Editor/IDE/REPL Setup</a>
<ul class="sectlevel2">
<li><a href="#_repl">11.1. REPL</a></li>
<li><a href="#_cursive">11.2. Cursive</a>
<ul class="sectlevel3">
<li><a href="#_cursive_repl_integration">11.2.1. Cursive REPL Integration</a></li>
</ul>
</li>
<li><a href="#_cider">11.3. CIDER</a></li>
</ul>
</li>
<li><a href="#_what_to_do_when_things_don_t_work">12. What to do when things don’t work?</a></li>
<li><a href="#_hacking">13. Hacking</a>
<ul class="sectlevel2">
<li><a href="#_patching_libraries">13.1. Patching Libraries</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a><a class="link" href="#_introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a work in progress. It has not been proofread and may contain errors. If you find an error, please
submit a PR to fix it, or an issue with details of the problem.</p>
</div>
<div class="sect2">
<h3 id="_why_shadow_cljs"><a class="anchor" href="#_why_shadow_cljs"></a><a class="link" href="#_why_shadow_cljs">1.1. Why shadow-cljs?</a></h3>
<div class="paragraph">
<p>The shadow-cljs compiler provides everything you need to compile your
ClojureScript code with a focus on simplicity and ease of use. It augments
the official ClojureScript compiler with a number of additional
features and enhancements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>More reliable NPM integration</p>
<div class="ulist">
<ul>
<li>
<p>More likely your favorite js library will work</p>
</li>
</ul>
</div>
</li>
<li>
<p>Less configuration</p>
</li>
<li>
<p>Deterministic build order</p>
</li>
<li>
<p>No need for build-specific source directories</p>
</li>
<li>
<p>Better externs checker</p>
</li>
<li>
<p>Better warning tracker</p>
</li>
<li>
<p>Easier use with js projects</p>
</li>
<li>
<p>Includes hot code reload</p>
</li>
<li>
<p>Smart integration with CLJS testing for the browser and CI</p>
</li>
<li>
<p>The built-in development server aggressively fixes browser caching issues</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_conventions_used_in_this_book"><a class="anchor" href="#_conventions_used_in_this_book"></a><a class="link" href="#_conventions_used_in_this_book">1.2. Conventions Used in this Book</a></h3>
<div class="paragraph">
<p>There are many examples in this book. Most things used in these should be obvious from their context,
but to prevent misunderstanding it is important to know the author&#8217;s intentions.</p>
</div>
<div class="paragraph">
<p>When command-line examples are given we may include BASH comments (starting with <code>#</code>), and will
usually include the standard user UNIX prompt of <code>$</code> to indicate separation of the command
from its output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># A comment. This command lists files:
$ ls -l
shadow-cljs.edn
project.clj
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many of the examples are of the configuration file for the compiler. This file contains an EDN map.
Where we have already discussed required options we will often elide them for clarity. In this
case we&#8217;ll usually include an elipsis to indicate "content that is required but isn&#8217;t in our
current focus":</p>
</div>
<div class="listingblock">
<div class="title">Example 1. Specify dependencies</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span> [[lib <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>]]}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example 2. Add source paths</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows us to concisely include enough context to understand the nesting of the configuration of
interest:</p>
</div>
<div class="listingblock">
<div class="title">Example 3. Nested option</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:build-id</span> {<span class="keyword">..</span><span class="keyword">.</span>
                     <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">resources/public/js</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Code examples may are similarly shortened.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quick_start"><a class="anchor" href="#_quick_start"></a><a class="link" href="#_quick_start">2. Quick Start</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installing_the_tools"><a class="anchor" href="#_installing_the_tools"></a><a class="link" href="#_installing_the_tools">2.1. Installing the Tools</a></h3>
<div class="paragraph">
<p>You will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>npm</code> or <code>yarn</code>.</p>
</li>
<li>
<p>A <code>package.json</code> file describing your development dependencies.</p>
</li>
<li>
<p>(optional) A global install of the <code>shadow-cljs</code> CLI.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">NPM</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ npm install --save-dev shadow-cljs
$ npm install -g shadow-cljs</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Yarn</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ yarn add --dev shadow-cljs
$ yarn global add shadow-cljs</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_code_shadow_cljs_code"><a class="anchor" href="#_running_code_shadow_cljs_code"></a><a class="link" href="#_running_code_shadow_cljs_code">2.2. Running <code>shadow-cljs</code></a></h3>
<div class="paragraph">
<p>If installed globally you can just invoke it directly</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs help</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer to only use the local install you can invoke it via <code>npx</code> or <code>yarn</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># npm
$ npx shadow-cljs help

# yarn
$ yarn shadow-cljs help

# manually
$ ./node_modules/.bin/shadow-cljs help</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_server_mode"><a class="anchor" href="#_server_mode"></a><a class="link" href="#_server_mode">2.2.1. Server Mode</a></h4>
<div class="paragraph">
<p>Starting a <code>shadow-cljs</code> command can be fairly slow to start. To improve this <code>shadow-cljs</code> can run in "server mode" which
means that a dedicated process is started which all other commands can use to execute a lot faster since they won&#8217;t have
to start a new JVM/Clojure instance.</p>
</div>
<div class="paragraph">
<p>Commands that do long running things implicitly start a server instance (eg. <code>watch</code>) but it is often advisable to have
a dedicated server process running.</p>
</div>
<div class="paragraph">
<p>You can either run the process in the foreground in a dedicated terminal. Use <code>CTRL+C</code> to terminate the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs server

# or (if you'd like REPL to control the server process)
$ shadow-cljs clj-repl</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also run the server in the background controlled via the common <code>start|stop|restart</code> functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs start
$ shadow-cljs stop
$ shadow-cljs restart</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once any server is running every other command will use that and run much faster.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_tool_integration"><a class="anchor" href="#_build_tool_integration"></a><a class="link" href="#_build_tool_integration">2.3. Build Tool Integration</a></h3>
<div class="sect3">
<h4 id="Leiningen"><a class="anchor" href="#Leiningen"></a><a class="link" href="#Leiningen">2.3.1. Leiningen Integration</a></h4>
<div class="paragraph">
<p>If you&#8217;d like to use Leiningen for your build system (particularly if you use Cursive) then there is a simple option
in your <code>shadow-cljs.edn</code> file that causes it to derive <code>:source-paths</code> and <code>:dependencies</code> from <code>project.clj</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:lein</span> <span class="predefined-constant">true</span>
 <span class="comment">; source-paths and dependencies are now ignored in this file, and come from project.clj instead</span>
 <span class="symbol">:builds</span> { <span class="keyword">..</span><span class="keyword">.</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that you don&#8217;t need to split up your source paths for <code>shadow-cljs</code>. It can derive which files are needed
from the namespace dependency graph and module settings.</p>
</div>
<div class="sect4">
<h5 id="_running_tasks_directly_from_leiningen"><a class="anchor" href="#_running_tasks_directly_from_leiningen"></a><a class="link" href="#_running_tasks_directly_from_leiningen">Running Tasks Directly From Leiningen</a></h5>
<div class="paragraph">
<p>shadow-cljs is built as a Clojure library, which means you can use it directly from lein without
installing the CLI command via npm.</p>
</div>
<div class="paragraph">
<p>You only need to add <code>shadow-cljs</code> to your <code>project.clj</code> <code>:dependencies</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://clojars.org/thheller/shadow-cljs"><img src="https://camo.githubusercontent.com/f91298f67b2b1c7a75124738f669be1f6928e976/68747470733a2f2f696d672e736869656c64732e696f2f636c6f6a6172732f762f746868656c6c65722f736861646f772d636c6a732e737667" alt="68747470733a2f2f696d672e736869656c64732e696f2f636c6f6a6172732f762f746868656c6c65722f736861646f772d636c6a732e737667"></a>
</div>
</div>
<div class="paragraph">
<p>The classpath of your project will be used to search for .cljs files. There is no
other dedicated configuration for shadow-cljs in project.clj. If you have a dedicated
directory for your .cljs files add that to your top-level <code>:source-paths</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This works even if you don&#8217;t enable full integration in the <code>shadow-cljs.edn</code> configuration
file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some sample commands are listed below:</p>
</div>
<div class="listingblock">
<div class="title">Listing Options</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">lein run -m shadow.cljs.devtools.cli help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Start a dev mode build with a REPL and live-reload</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ lein run -m shadow.cljs.devtools.cli watch build-id</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Just compile :dev mode once, no REPL or live-reload:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ lein run -m shadow.cljs.devtools.cli compile build-id</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Create a :release mode optimized build:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">lein run -m shadow.cljs.devtools.cli release build-id</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_full_integration"><a class="anchor" href="#_full_integration"></a><a class="link" href="#_full_integration">Full Integration</a></h5>
<div class="paragraph">
<p>The <code>shadow-cljs</code> command-line utility can also use <code>lein</code> to run your commands. You can enable this
by adding a :lein entry to your shadow-cljs.edn config.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:lein</span> {<span class="symbol">:profile</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">+cljs</span><span class="delimiter">&quot;</span></span>}
 <span class="symbol">:builds</span> {<span class="keyword">..</span><span class="keyword">.</span>}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will execute all <code>shadow-cljs</code> commands via <code>lein</code> instead of launching its own JVM. The <code>:profile</code> is optional,
<code>:lein true</code> or <code>:lein {}</code> is enough to enable lein support. When this mode is active the <code>:source-paths</code> and
<code>:dependencies</code> inside <code>shadow-cljs.edn</code> will be ignored.</p>
</div>
<div class="listingblock">
<div class="title">The <code>lein</code> command used by <code>shadow-cljs</code> as configured above</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">lein with-profile +cljs run -m shadow.cljs.devtools.cli ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_boot"><a class="anchor" href="#_boot"></a><a class="link" href="#_boot">2.3.2. Boot</a></h4>
<div class="paragraph">
<p>The authors have little Boot experience, so this chapter is in need of contributions. We understand
that Boot allows you to build your tool chain out of functions. Since <code>shadow-cljs</code> is a normal
JVM library with functions that you can call to invoke tasks.</p>
</div>
<div class="paragraph">
<p>Some boot tasks are available here:
<a href="https://github.com/jgdavey/boot-shadow-cljs" class="bare">https://github.com/jgdavey/boot-shadow-cljs</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_embedding"><a class="anchor" href="#_embedding"></a><a class="link" href="#_embedding">2.4. Embedding</a></h3>
<div class="paragraph">
<p>It is possible to run <code>shadow-cljs</code> inside your JVM.</p>
</div>
<div class="listingblock">
<div class="title">TODO</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">require</span> 'shadow.cljs.devtools.server)
(shadow.cljs.devtools.server/start!)
(shadow.cljs.devtools.server/stop!)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a><a class="link" href="#_configuration">3. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>shadow-cljs</code> is configured by a <code>shadow-cljs.edn</code> file in your project root directory. You can
create a default one by running <code>shadow-cljs init</code>. It should contain a map with some global
configuration and a <code>:builds</code> entry for all your builds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]
 <span class="symbol">:dependencies</span> [] <span class="comment">; These are CLJS dependencies, NOT node. Use package.json for npm.</span>
 <span class="symbol">:builds</span> {}}</code></pre>
</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:dependencies</code>
</td>
<td class="hdlist2">
<p>manage your CLJS dependencies in the same format as <code>leiningen</code> or <code>boot</code>. These are for JVM dependencies
in all target modes. External JS dependencies use the standard <code>package.json</code>, installed via <code>npm</code> or <code>yarn</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:source-paths</code>
</td>
<td class="hdlist2">
<p>define where the compiler will look for <code>.cljs</code> and <code>.cljc</code> source files.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:builds</code>
</td>
<td class="hdlist2">
<p>is a map of build-id (a keyword) to the build config.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example config could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span>
 [[reagent <span class="string"><span class="delimiter">&quot;</span><span class="content">0.8.0-alpha2</span><span class="delimiter">&quot;</span></span>]]

 <span class="symbol">:source-paths</span>
 [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]

 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="symbol">:target</span> <span class="symbol">:browser</span>
        <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
        <span class="symbol">:asset-path</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/js</span><span class="delimiter">&quot;</span></span>
        <span class="symbol">:modules</span> {<span class="symbol">:main</span> {<span class="symbol">:entries</span> [my.app]}}}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file structure for this example should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">.</span>
<span class="error">├</span><span class="error">─</span><span class="error">─</span> package.json
<span class="error">├</span><span class="error">─</span><span class="error">─</span> shadow-cljs.edn
<span class="error">└</span><span class="error">─</span><span class="error">─</span> src
    <span class="error">└</span><span class="error">─</span><span class="error">─</span> my
        <span class="error">└</span><span class="error">─</span><span class="error">─</span> app.cljs</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_build_targets"><a class="anchor" href="#_build_targets"></a><a class="link" href="#_build_targets">3.1. Build Targets</a></h3>
<div class="paragraph">
<p>Each build in <code>shadow-cljs</code> must define a <code>:target</code> which defines where you intend
your code to be executed. There are default built-ins for the <a href="#BrowserTarget">browser</a> and <a href="#NodeTarget"><code>node.js</code></a>.
They all share the basic concept of having <code>:dev</code> and <code>:release</code> modes.
<code>:dev</code> mode provides all the usual development goodies like fast compilation, live code
reloading and a REPL. <code>:release</code> mode will produce optimized output intended for production.</p>
</div>
<div class="paragraph">
<p>Targets are covered in separate chapters.</p>
</div>
</div>
<div class="sect2">
<h3 id="_compilation"><a class="anchor" href="#_compilation"></a><a class="link" href="#_compilation">3.2. Compilation</a></h3>
<div class="paragraph">
<p><code>shadow-cljs</code> has 2 compilation modes: <code>:dev</code> and <code>:release</code>. <code>:dev</code> will inject a few
development helpers for dealing with things like a CLJS REPL and live code reloading.
In <code>:release</code> mode those things will not be included and the code will be optimized by the Closure Compiler.</p>
</div>
<div class="listingblock">
<div class="title">Sample Development Mode Commands</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># compile a build once in :dev mode
$ shadow-cljs compile app

# compile and watch
$ shadow-cljs watch app

# connect to REPL for the build (available while watch is running)
$ shadow-cljs cljs-repl app

# (if you are targeting node) connect to node-repl
$ shadow-cljs node-repl</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Running a release build optimized for production use.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs release app</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes you may run into some release issues due to <code>:advanced</code> compilation. These
commands can help track down the causes.</p>
</div>
<div class="listingblock">
<div class="title">Release debugging commands.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs check app
$ shadow-cljs release app --debug</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="CommonConfig"><a class="anchor" href="#CommonConfig"></a><a class="link" href="#CommonConfig">3.3. Main Configuration</a></h3>
<div class="paragraph">
<p>The first options you need to set are the location of your source folder(s) and your dependencies.
All settings go in <code>shadow-cljs.edn</code> in the top-level directory of your project. In this book
any ambiguous reference to "configuration file" should be assumed to mean this file.</p>
</div>
<div class="listingblock">
<div class="title">The main configuration file: <code>shadow-cljs.edn</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span> [[some-library <span class="string"><span class="delimiter">&quot;</span><span class="content">1.2.1</span><span class="delimiter">&quot;</span></span>] <span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]
 <span class="keyword">..</span><span class="keyword">.</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_code_source_paths_code"><a class="anchor" href="#_code_source_paths_code"></a><a class="link" href="#_code_source_paths_code">3.3.1. <code>:source-paths</code></a></h4>
<div class="paragraph">
<p>Notice that the source path is <strong>only</strong> specified once in the entire configuration. The system will
use namespace dependency graphs to determine what code is needed in the final output of any given
build.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_builds_code"><a class="anchor" href="#_code_builds_code"></a><a class="link" href="#_code_builds_code">3.3.2. <code>:builds</code></a></h4>
<div class="paragraph">
<p>You will also need a <code>:builds</code> section. Builds should be a map of builds <strong>keyed</strong> by build ID:</p>
</div>
<div class="listingblock">
<div class="title">A configuration file with a build map.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span> [[some-library <span class="string"><span class="delimiter">&quot;</span><span class="content">1.2.1</span><span class="delimiter">&quot;</span></span>] <span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>  {<span class="symbol">:target</span>     <span class="symbol">:browser</span>
         <span class="keyword">..</span><span class="keyword">.</span> target-specific options <span class="keyword">..</span><span class="keyword">.</span>}
 <span class="symbol">:tests</span> {<span class="symbol">:target</span> <span class="symbol">:karma</span>
         <span class="keyword">..</span><span class="keyword">.</span> target-specific options <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each build describes artifacts that the compiler will build. The build target is an
extensible feature of <code>shadow-cljs</code>, and the compiler comes with quite a few of them already.</p>
</div>
<div class="paragraph">
<p>Here are some of them:</p>
</div>
<div class="dlist Horizontal">
<dl>
<dt><code>:browser</code></dt>
<dd>
<p>Output code suitable for running in a web browser.</p>
</dd>
<dt><code>:bootstrap</code></dt>
<dd>
<p>Output code suitable for running in bootstrapped cljs environment.</p>
</dd>
<dt><code>:browser-test</code></dt>
<dd>
<p>Scan for tests to determine required files, and output tests suitable for running in the browser.</p>
</dd>
<dt><code>:karma</code></dt>
<dd>
<p>Scan for tests to determine required files, and output karma-runner compatible tests. See <a href="http://karma-runner.github.io/2.0/index.html">Karma</a>.</p>
</dd>
<dt><code>:node-library</code></dt>
<dd>
<p>Output code suitable for use as a node library.</p>
</dd>
<dt><code>:node-script</code></dt>
<dd>
<p>Output code suitable for use as a node script.</p>
</dd>
<dt><code>:npm-module</code></dt>
<dd>
<p>Output code suitable for use as an NPM module.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Each target is covered in more detail in its own chapter since the remaining build options vary on
the target you select.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server_options"><a class="anchor" href="#_server_options"></a><a class="link" href="#_server_options">3.4. Server Options</a></h3>
<div class="paragraph">
<p>This section is for other options that configure the <code>shadow-cljs</code> server instance.</p>
</div>
<div class="sect3">
<h4 id="nREPL"><a class="anchor" href="#nREPL"></a><a class="link" href="#nREPL">3.4.1. nREPL</a></h4>
<div class="paragraph">
<p>The <code>shadow-cljs</code> server provides a nREPL server via TCP. If you look at the startup message you&#8217;ll see
the port of nREPL, and the port will also be stored in <code>target/shadow-cljs/nrepl.port</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs watch dev
shadow-cljs - HTTP server for &quot;:app&quot; available at http://localhost:8020
shadow-cljs - server running at http://0.0.0.0:9630
shadow-cljs - nrepl running at /0.0.0.0:9462
shadow-cljs - watching build :app
[:app] Configuring build.
[:app] Compiling ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure the port and additional middleware with <code>shadow-cljs.edn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:nrepl</span> {<span class="symbol">:port</span> <span class="integer">9000</span>
         <span class="symbol">:middleware</span> []} <span class="comment">; list of namespace-qualified symbols</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_http"><a class="anchor" href="#_http"></a><a class="link" href="#_http">3.4.2. HTTP</a></h4>

</div>
<div class="sect3">
<h4 id="_ssl"><a class="anchor" href="#_ssl"></a><a class="link" href="#_ssl">3.4.3. SSL</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="_development_options"><a class="anchor" href="#_development_options"></a><a class="link" href="#_development_options">3.5. Development Options</a></h3>
<div class="paragraph">
<p>Each build <code>:target</code> typically provides some development support. They are grouped under the <code>:devtools</code> key for each <code>:build</code>.</p>
</div>
<div class="sect3">
<h4 id="_preloads"><a class="anchor" href="#_preloads"></a><a class="link" href="#_preloads">3.5.1. Preloads</a></h4>
<div class="paragraph">
<p>As a developer most of your time is spent in development mode. You&#8217;re probably familiar with tools like <code>figwheel</code>,
<code>boot-reload</code>, and <code>devtools</code>. It&#8217;s almost certain that you want one or more of these in your builds.</p>
</div>
<div class="paragraph">
<p>Preloads are used to force certain namespaces into the front of your generated Javascript. This is
generally used to inject tools and instrumentation before the application actually loads and runs. The
preloads option is simply a list of namespaces in the <code>:devtools</code>/<code>:preloads</code> section of
<code>shadow-cljs-edn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="keyword">..</span><span class="keyword">.</span>
        <span class="symbol">:devtools</span> {<span class="symbol">:preloads</span> [fulcro.inspect.preload]
                   <span class="keyword">..</span><span class="keyword">.</span>}}}}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Since version 2.0.130 shadow-cljs automatically adds "binaryage/cljs-devtools" to the preloads in
<code>watch</code> and <code>compile</code> if they are on the classpath. All you need to do is make sure it is in your
<code>dependencies</code> list.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_hot_code_reload"><a class="anchor" href="#_hot_code_reload"></a><a class="link" href="#_hot_code_reload">3.5.2. Hot Code Reload</a></h4>
<div class="paragraph">
<p>The React and ClojureScript ecosystems combine to make this kind of thing super useful. The <code>shadow-cljs</code>
system includes everything you need to do your hot code reload, without needing to resort to external tools.</p>
</div>
<div class="paragraph">
<p>In order to use it you simply run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">shadow-cljs watch build-id</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lifecycle_hooks"><a class="anchor" href="#_lifecycle_hooks"></a><a class="link" href="#_lifecycle_hooks">3.5.3. Lifecycle Hooks</a></h4>
<div class="paragraph">
<p>The build configuration supports hooks that allow you to run functions just before hot code reload
brings in updated code, and just after. These are useful for stopping/starting things that would otherwise
close over old code. The options go in the <code>:devtools</code> section of the build config and are:</p>
</div>
<div class="dlist Horizontal">
<dl>
<dt><code>:before-load</code></dt>
<dd>
<p>A symbol (with namespace) of a function to run just before refreshing
files that have been recompiled.  This function <strong>must</strong> by synchronous in nature.</p>
</dd>
<dt><code>:before-load-async</code></dt>
<dd>
<p>A symbol (with namespace) of a function <code>(fn [done] )</code> to run just before refreshing. This function
can do async processing, but <strong>must</strong> call <code>(done)</code> to indicate it is complete.</p>
</dd>
<dt><code>:after-load</code></dt>
<dd>
<p>A symbol (with namespace) of a function to run after hot code reload is complete.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">A sample of lifecycle hooks.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="keyword">..</span><span class="keyword">.</span>
        <span class="symbol">:devtools</span> {<span class="symbol">:before-load</span>  my.app/stop
                   <span class="symbol">:after-load</span>   my.app/start
                   <span class="keyword">..</span><span class="keyword">.</span>}}}}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="UsingNPMModules"><a class="anchor" href="#UsingNPMModules"></a><a class="link" href="#UsingNPMModules">4. Using JavaScript Dependencies</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The standard ClojureScript compiler has <a href="https://code.thheller.com/blog/shadow-cljs/2017/09/15/js-dependencies-the-problem.html">some issues</a>
when dealing with Javascript dependencies.</p>
</div>
<div class="paragraph">
<p>The summary of these is</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CLJSJS/:foreign-libs do not scale</p>
</li>
<li>
<p>Custom bundles are tedious to work with</p>
</li>
<li>
<p>Closure Compiler can’t yet reliably process a large portion of npm packages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To address these issues <code>shadow-cljs</code> implements a custom JS bundler and removes :foreign-libs support.
The intention is to make the vast majority of the JS ecosystem easily accessible from
Javascript.</p>
</div>
<div class="sect2">
<h3 id="_installing_js_dependencies"><a class="anchor" href="#_installing_js_dependencies"></a><a class="link" href="#_installing_js_dependencies">4.1. Installing JS Dependencies</a></h3>
<div class="paragraph">
<p>Almost every package on npm will explain how to install it. Those instructions now apply to shadow-cljs
as well. So if a library tells you to run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ npm install the-thing</code></pre>
</div>
</div>
<div class="paragraph">
<p>then that is exactly what to do. Nothing more is required. You may use yarn if prefer. Dependencies will
be added to the <code>package.json</code> file and this will be used to manage them. If you don’t have a
<code>package.json</code> yet run <code>npm init</code> from a command line.</p>
</div>
<div class="paragraph">
<p>You can use this <a href="https://github.com/shadow-cljs/quickstart-browser">Quick-Start template</a>
to try everything described in this section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_js_dependencies"><a class="anchor" href="#_using_js_dependencies"></a><a class="link" href="#_using_js_dependencies">4.2. Using JS Dependencies</a></h3>
<div class="paragraph">
<p>Most npm packages will also include some instructions on how to use the actual code. The
“old” CommonJS style just has require calls which translates directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="keyword">var</span> react = require(<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.app</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> react]))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whatever "string" parameter is used when calling require we transfer to the <code>:require</code> as-is.
The <code>:as</code> alias is up to you. Once we have that we can use the code like any other CLJS namespace!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(react/createElement <span class="string"><span class="delimiter">&quot;</span><span class="content">div</span><span class="delimiter">&quot;</span></span> <span class="predefined-constant">nil</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>shadow-cljs</code>: <strong>always use the <code>ns</code> form and whatever <code>:as</code> alias you provided.</strong>
You may also use <code>:refer</code> and <code>:rename</code>. This is different than what <code>:foreign-libs</code>/CLJSJS does
where you include the thing in the namespace but then used a global <code>js/Thing</code> in your code.</p>
</div>
<div class="paragraph">
<p>Some packages just export a single function which you can call directly by
using <code>(:require ["thing" :as thing])</code> and then <code>(thing)</code>.</p>
</div>
<div class="paragraph">
<p>More recently some packages started using ES6 <code>import</code> statements in their examples. Those also
translate pretty much 1:1 with one slight difference related to default exports.
The following table can be used for translation:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. ES6 Import to CLJS Require</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ES6 Import</th>
<th class="tableblock halign-left valign-top">CLJS Require</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import defaultExport from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :default defaultExport])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import * as name from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :as name])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import { export } from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :refer (export)])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import { export as alias } from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :rename {export alias}])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import { export1 , export2 } from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :refer (export1 export2)])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import { export1 , export2 as alias2 , [&#8230;&#8203;] } from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :refer (export1) :rename {export2 alias2}])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import defaultExport, { export [ , [&#8230;&#8203;] ] } from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :refer (export) :default defaultExport])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import defaultExport, * as name from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :as name :default defaultExport])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name"])</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>:default</code> option is currently only available in <code>shadow-cljs</code>, you can
<a href="https://dev.clojure.org/jira/browse/CLJS-2376">vote here</a> to hopefully make it standard.
You can always use <code>:as alias</code> and then call <code>alias/default</code> if you prefer to stay compatible
with standard CLJS in the meantime.</p>
</div>
<div class="paragraph">
<p>Notice that previously we were stuck using bundled code which included a lot of code we
didn’t actually need. Now we&#8217;re in a better situation:
Some libraries are also packaged in ways  ways that allow you to include only the parts you need,
leading to much less code in your final build.</p>
</div>
<div class="paragraph">
<p><code>react-virtualized</code> is a great example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="comment">// You can import any component you want as a named export from 'react-virtualized', eg</span>
<span class="reserved">import</span> { Column, Table } from <span class="string"><span class="delimiter">'</span><span class="content">react-virtualized</span><span class="delimiter">'</span></span>

<span class="comment">// But if you only use a few react-virtualized components,</span>
<span class="comment">// And you're concerned about increasing your application's bundle size,</span>
<span class="comment">// You can directly import only the components you need, like so:</span>
<span class="reserved">import</span> AutoSizer from <span class="string"><span class="delimiter">'</span><span class="content">react-virtualized/dist/commonjs/AutoSizer</span><span class="delimiter">'</span></span>
<span class="reserved">import</span> List from <span class="string"><span class="delimiter">'</span><span class="content">react-virtualized/dist/commonjs/List</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With our improved support we we can easily translate this to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my-ns</span>
  <span class="comment">;; all</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">react-virtualized</span><span class="delimiter">&quot;</span></span> <span class="symbol">:refer</span> (Column Table)])
  <span class="comment">;; OR one by one</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">react-virtualized/dist/commonjs/AutoSizer</span><span class="delimiter">&quot;</span></span> <span class="symbol">:default</span> virtual-auto-sizer]
            [<span class="string"><span class="delimiter">&quot;</span><span class="content">react-virtualized/dist/commonjs/List</span><span class="delimiter">&quot;</span></span> <span class="symbol">:default</span> virtual-list]))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resolving_js_dependencies"><a class="anchor" href="#_resolving_js_dependencies"></a><a class="link" href="#_resolving_js_dependencies">4.3. Resolving JS Dependencies</a></h3>
<div class="paragraph">
<p>By default <code>shadow-cljs</code> will resolve all <code>(:require ["thing" :as x])</code> requires following the npm convention.
This means it will look at <code>&lt;project&gt;/node_modules/thing/&#8230;&#8203;</code> and follow the code from there. To
customize how this works <code>shadow-cljs</code> exposes a <code>:resolve</code> config option that lets you override how
things are resolved.</p>
</div>
<div class="sect3">
<h4 id="_using_a_cdn"><a class="anchor" href="#_using_a_cdn"></a><a class="link" href="#_using_a_cdn">4.3.1. Using a CDN</a></h4>
<div class="paragraph">
<p>Say you already have React included in your page via a CDN. You could just start using <code>js/React</code> again
but we stopped doing that for a good reason. Instead you can continue to use <code>(:require ["react" :as react])</code>
but configure how "react" resolves!</p>
</div>
<div class="paragraph">
<p>Here is a sample <code>shadow-cljs.edn</code> config for such a build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:js-options</span>
   {<span class="symbol">:resolve</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:target</span> <span class="symbol">:global</span>
                       <span class="symbol">:global</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">React</span><span class="delimiter">&quot;</span></span>}}}}

  <span class="symbol">:server</span>
  {<span class="symbol">:target</span> <span class="symbol">:node-script</span>
   <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>:app</code> build will now use the global <code>React</code> instance while the <code>:server</code> build continues using
the "react" npm package! No need to fiddle with the code to make this work.</p>
</div>
</div>
<div class="sect3">
<h4 id="_redirecting_require"><a class="anchor" href="#_redirecting_require"></a><a class="link" href="#_redirecting_require">4.3.2. Redirecting “require”</a></h4>
<div class="paragraph">
<p>Some packages provide multiple “dist” files and sometimes the default one described doesn’t quite work
in <code>shadow-cljs</code>. One good example for this is "d3". Their default "main" points to "build/d3.node.js" but
that is not what we want when working with the browser. Their ES6 code runs into a bug in the Closure Compiler,
so we can’t use that. Instead we just redirect the require to some other file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:js-options</span>
   {<span class="symbol">:resolve</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">d3</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:target</span> <span class="symbol">:npm</span>
                    <span class="symbol">:require</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">d3/build/d3.js</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also just <code>(:require ["d3/build/d3.js" :as d3])</code> as well if you only care about the Browser.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_local_files"><a class="anchor" href="#_using_local_files"></a><a class="link" href="#_using_local_files">4.3.3. Using local Files</a></h4>
<div class="paragraph">
<p>You may also use :resolve to directly map to files in your project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">..</span><span class="keyword">.</span>
    {<span class="symbol">:resolve</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">my-thing</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:target</span> <span class="symbol">:file</span>
                           <span class="symbol">:file</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/file.js</span><span class="delimiter">&quot;</span></span>}}}
<span class="keyword">..</span><span class="keyword">.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>:file</code> is always relative to the project directory. The included file may use require or
<code>import/export</code> and those will be followed and included properly as well.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_migrating_cljsjs"><a class="anchor" href="#_migrating_cljsjs"></a><a class="link" href="#_migrating_cljsjs">4.4. Migrating cljsjs.*</a></h3>
<div class="paragraph">
<p>Many CLJS libraries are still using CLJSJS packages and they would break with <code>shadow-cljs</code> since it
no longer supports <code>:foreign-libs</code>. I have a clear migration path for this and it just
requires one shim file that maps the <code>cljsjs.thing</code> back to its original npm package and
exposes the expected global variable.</p>
</div>
<div class="paragraph">
<p>For React this requires a file like <code>src/cljsjs/react.cljs</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">cljsjs.react</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> react]
            [<span class="string"><span class="delimiter">&quot;</span><span class="content">create-react-class</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> crc]))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(js/goog.object.set react <span class="string"><span class="delimiter">&quot;</span><span class="content">createClass</span><span class="delimiter">&quot;</span></span> crc)
(js/goog.exportSymbol <span class="string"><span class="delimiter">&quot;</span><span class="content">React</span><span class="delimiter">&quot;</span></span> react)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since this would be tedious for everyone to do manually I created the <a href="https://github.com/thheller/shadow-cljsjs"><code>shadow-cljsjs</code></a>
library which provides just that. It does not include every package but I’ll keep adding
them and contributions are very welcome as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>shadow-cljsjs</code> library only provides the shim files. You’ll still need to
<code>npm install</code> the actual packages yourself.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="BrowserTarget"><a class="anchor" href="#BrowserTarget"></a><a class="link" href="#BrowserTarget">5. Targeting the Browser</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are a few targets that target web browsers in various ways, and since the targets are pluggable
it is easy to imagine additional targets for specific scenarios. This chapter concentrates on the
most commonly-used <code>:browser</code> target, but many of the configuration options may apply to other
browser-related targets.</p>
</div>
<div class="paragraph">
<p>A basic browser configuration looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:source-paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]

 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="symbol">:target</span> <span class="symbol">:browser</span>
        <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/assets/app/js</span><span class="delimiter">&quot;</span></span>
        <span class="symbol">:asset-path</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/assets/app/js</span><span class="delimiter">&quot;</span></span>
        <span class="symbol">:modules</span> {<span class="symbol">:main</span> {<span class="symbol">:entries</span> [my.app]}}}]}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_output_settings"><a class="anchor" href="#_output_settings"></a><a class="link" href="#_output_settings">5.1. Output Settings</a></h3>
<div class="paragraph">
<p>The browser target outputs a lot of files, and a directory is needed for them all. You&#8217;ll need to serve
these assets with some kind of server, and the Javascript loading code needs to know the server-centric
path to these assets. The options you need to specify are:</p>
</div>
<div class="dlist Horizontal">
<dl>
<dt><code>:output-dir</code></dt>
<dd>
<p>The directory to use for all js output.</p>
</dd>
<dt><code>:asset-path</code></dt>
<dd>
<p>The relative path from <strong>web server&#8217;s root</strong> to the resources in <code>:output-dir</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Your entry point javascript file and all related js files will appear in <code>:output-dir</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Each build requires its own :output-dir, you may not put multiple builds into the same directory.
This directory should also be exclusively owned by the build. There should be no other files in there.
While <code>shadow-cljs</code> won&#8217;t delete anything it is safer to leave it alone. Compilation
creates many more files than just the main entry point javascript file during development:
source maps, original sources, and generated sources.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>:asset-path</code> is a prefix that gets added to the paths of module loading code inside of the
generated javascript. It allows you to output your javascript module to a particular subdirectory
of your web server&#8217;s root. The dynamic loading during development (hot code reload) and production
(code splitting) need this to correctly locate files.</p>
</div>
<div class="paragraph">
<p>Locating your generated files in a directory and asset path like this make it so that other assets
(images, css, etc.) can easily co-exist on the same server without accidental collisions.</p>
</div>
<div class="paragraph">
<p>For example: if your web server will serve the folder <code>public/x</code> when asked for the URI <code>/x</code>,
and your <code>output-dir</code> for a module is <code>public/assets/app/js</code> then your asset-path should be <code>/assets/app/js</code>.
You are not required to use an absolute asset path, but it is highly recommended.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modules"><a class="anchor" href="#_modules"></a><a class="link" href="#_modules">5.2. Modules</a></h3>
<div class="paragraph">
<p>The <code>modules</code> section of the config is always a map keyed by module ID. The module ID is also used
to generate the Javascript filename. This is so the module loading code can easily find the correct file
without additional configuration.</p>
</div>
<div class="paragraph">
<p>All projects will have one or more modules. If you&#8217;re doing code splitting, then you will have more than one.
If you&#8217;re not <a href="#CodeSpliting">code splitting</a> then you&#8217;ll typically have just have one.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It&#8217;s perfectly
fine for a module&#8217;s <code>:entries</code> to contain as many "entry points", "mini apps", or global functions as you care
to put in it, so you do <strong>not</strong> need separate modules to do that.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The available options in a module are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:entries</code>
</td>
<td class="hdlist2">
<p>The namespaces that serve as the root nodes of the dependency graph for the output code of this module.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:depends-on</code>
</td>
<td class="hdlist2">
<p>The names of other modules that must be loaded in order for this one to have everything it needs.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:prepend</code>
</td>
<td class="hdlist2">
<p>String content that will be prepended to the js output. Useful for comments, copyright notice, etc.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:append</code>
</td>
<td class="hdlist2">
<p>String content that will be appended to the js output. Useful for comments, copyright notice, etc.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:prepend-js</code>
</td>
<td class="hdlist2">
<p>A string to prepend to the module output containing valid javascript that will be run through Closure optimizer.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:append-js</code>
</td>
<td class="hdlist2">
<p>A string to append to the module output containing valid javascript that will be run through Closure optimizer.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows a minimum module configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="keyword">..</span><span class="keyword">.</span>
        <span class="symbol">:modules</span> {<span class="symbol">:main</span> {<span class="symbol">:entries</span> [my.app.main]}}}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>shadow-cljs</code> will follow the dependency graph from the root set of code entry points in the <code>:entries</code>
to find everything needed to actually run.</p>
</div>
</div>
<div class="sect2">
<h3 id="_http_server"><a class="anchor" href="#_http_server"></a><a class="link" href="#_http_server">5.3. HTTP Server</a></h3>
<div class="paragraph">
<p>The <code>:devtools</code> section of the configuration for <code>:browser</code> supports a few additional
options for configuring an optional dev-time HTTP server for a build. The server supports the following
options:</p>
</div>
<div class="dlist Horizontal">
<dl>
<dt><code>:http-root</code></dt>
<dd>
<p>The disk path from which to serve root filesystem requests. If not supplied,
no disk files are served.</p>
</dd>
<dt><code>:http-port</code></dt>
<dd>
<p>The port to serve from.</p>
</dd>
<dt><code>:http-host</code></dt>
<dd>
<p>The hostname to listen on. Defaults to localhost).</p>
</dd>
<dt><code>:http-resource-root</code></dt>
<dd>
<p>A path relative to classpath from which resources can be served.
If not supplied, no resources are served.</p>
</dd>
<dt><code>:http-handler</code></dt>
<dd>
<p>A namespace (as a symbol). A <code>(fn [req] resp)</code> that is used
if a resource is not found for the given request. Defaults to a not-found handler.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_development_http_and_uri_based_routing_push_state"><a class="anchor" href="#_development_http_and_uri_based_routing_push_state"></a><a class="link" href="#_development_http_and_uri_based_routing_push_state">5.3.1. Development HTTP and URI-based Routing (Push state)</a></h4>
<div class="paragraph">
<p>If your browser application uses browser push state then you will typically want
the server to respond with <code>index.html</code> instead of "Not Found" on URIs that have no
real resource (so you can just hit browser reload on your SPA even on odd URIs).</p>
</div>
<div class="paragraph">
<p>There is a built-in handler that you can add for this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
    {<span class="symbol">:builds</span>
      {<span class="symbol">:app</span> { <span class="keyword">..</span><span class="keyword">.</span>
              <span class="symbol">:devtools</span> { <span class="symbol">:http-handler</span> shadow.http.push-state/handle }}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It supports two additional options (in the <code>devtools</code> section):</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:push-state/headers</code>
</td>
<td class="hdlist2">
<p>(optional) A map of HTTP headers to respond with. Defaults to <code>text/html</code> standard headers.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:push-state/index</code>
</td>
<td class="hdlist2">
<p>(optional) The file to serve. Defaults to <code>index.html</code>.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_workers"><a class="anchor" href="#_web_workers"></a><a class="link" href="#_web_workers">5.4. Web Workers</a></h3>
<div class="paragraph">
<p>The <code>:modules</code> configuration may also be used to generate files intended to be used as a Web Workers.
You may declare any module (except the default) as a Web Worker by setting <code>:web-worker true</code>. The
generated file will contain some additional bootstrap code which will load its dependencies
automatically. The way <code>:modules</code> work also ensures that code used only by the worker will also only
be in the final file for the worker. Each worker should have a dedicated CLJS namespace.</p>
</div>
<div class="listingblock">
<div class="title">An example of generating a web worker script</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
   {<span class="symbol">:app</span>
    {<span class="symbol">:target</span> <span class="symbol">:browser</span>
     <span class="keyword">..</span><span class="keyword">.</span>
     <span class="symbol">:modules</span> {<span class="symbol">:main</span>   {<span class="symbol">:entries</span> [my.app]}
               <span class="symbol">:extra</span>  {<span class="symbol">:entries</span> [my.app.extra]
                        <span class="symbol">:depends-on</span> #{<span class="symbol">:main</span>}}
               <span class="symbol">:worker</span> {<span class="symbol">:entries</span> [my.app.worker]
                        <span class="symbol">:depends-on</span> #{<span class="symbol">:main</span>}
                        <span class="symbol">:web-worker</span> <span class="predefined-constant">true</span>}}}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration will generate <code>worker.js</code> which you can use to start the Web Worker.
It will have all code from the <code>:main</code> module available (but not <code>:extra</code>). The code in the
<code>my.app.worker</code> namespace will only ever execute in the worker. Worker generation happens in
both development and release modes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Hot code reload does not support reloading code in the worker while it is running.
I suggest shutting down all workers using the <code>:devtools :before-load</code> function and restarting it
in the <code>:after-load</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="CodeSplitting"><a class="anchor" href="#CodeSplitting"></a><a class="link" href="#CodeSplitting">5.5. Code Splitting</a></h3>
<div class="paragraph">
<p>You&#8217;ve already seen how to configure your main module. Adding additional modules requires a little
bit of care, but the technical details are simple:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure you don&#8217;t require things you don&#8217;t use in any namespace.</p>
</li>
<li>
<p>Put the top-level namespace(s) for each module into a module config.</p>
</li>
<li>
<p>Choose you dynamic loading API</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_using_shadow_cljs_s_built_in_loader_support"><a class="anchor" href="#_using_shadow_cljs_s_built_in_loader_support"></a><a class="link" href="#_using_shadow_cljs_s_built_in_loader_support">5.5.1. Using shadow-cljs&#8217;s built-in Loader Support</a></h4>
<div class="paragraph">
<p>The compiler supports generating the required data for <code>goog.module.ModuleManager</code> to work.
It exposes a simple interface to let you load modules on-demand at runtime.</p>
</div>
<div class="paragraph">
<p>You only need to add <code>:module-loader true</code> to your build config. The loader will
always be injected into the default module (the one everything else depends on).</p>
</div>
<div class="paragraph">
<p>At runtime you may use the <code>shadow.loader</code> namespace to load modules. You may also load a
module eagerly by just using a <code>&lt;script&gt;</code> tag in your page.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
   {<span class="symbol">:app</span>
     {<span class="symbol">:target</span> <span class="symbol">:browser</span>
      <span class="keyword">..</span><span class="keyword">.</span>
      <span class="symbol">:module-loader</span> <span class="predefined-constant">true</span>
      <span class="symbol">:modules</span> {<span class="symbol">:main</span>  {<span class="symbol">:entries</span> [my.app]}
                <span class="symbol">:extra</span> {<span class="symbol">:entries</span> [my.app.extra]
                        <span class="symbol">:depends-on</span> #{<span class="symbol">:main</span>}}}}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you had the following for your main entry point:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.app</span>
  (<span class="symbol">:require</span> [shadow.loader <span class="symbol">:as</span> loader]))

(<span class="keyword">defn</span> <span class="function">fn-to-call-on-load</span> []
  (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">extra loaded</span><span class="delimiter">&quot;</span></span>))

(<span class="keyword">defn</span> <span class="function">fn-to-call-on-error</span> []
  (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">extra load failed</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the following expressions can be used for loading code:</p>
</div>
<div class="listingblock">
<div class="title">Loading a module</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="comment">;; load returns a goog.async.Deferred, and can be used like a promise</span>
(<span class="keyword">-&gt;</span> (loader/load <span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span>)
    (<span class="keyword">.</span>then fn-to-call-on-load fn-to-call-on-error))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Loading many modules</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="comment">;; must be a JS array, also returns goog.async.Deferred</span>
(loader/load-many <span class="error">#</span>js [<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Including a callback</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(loader/with-module <span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span> fn-to-call-on-load)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check if a module is loaded using <code>(loaded? "module-name")</code>.</p>
</div>
<div class="sect4">
<h5 id="_loader_costs"><a class="anchor" href="#_loader_costs"></a><a class="link" href="#_loader_costs">Loader Costs</a></h5>
<div class="paragraph">
<p>Using the loader is very lightweight. It has a few dependencies which you may not be otherwise using.
In practice using <code>:module-loader true</code> adds about 8KB gzip&#8217;d
to the default module. This will vary depending on how much of <code>goog.net</code> and <code>goog.events</code>
you are already using, and what level of optimization you use for your release builds.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_standard_clojurescript_api"><a class="anchor" href="#_using_the_standard_clojurescript_api"></a><a class="link" href="#_using_the_standard_clojurescript_api">5.5.2. Using the Standard ClojureScript API</a></h4>
<div class="paragraph">
<p>The generated code is capable of using the standard ClojureScript <code>cljs.loader</code> API. See the
<a href="https://clojurescript.org/news/2017-07-10-code-splitting">documentation</a> on the ClojureScript
website for instructions.</p>
</div>
<div class="paragraph">
<p>The advantage of using the standard API is that your code will play well with others. This
may be of particular importance to library authors. The disadvantage is that the dynamic module
loading API in the standard distribution is currently somewhat less easy-to-use than the
support in <code>shadow-cljs</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="NameHashing"><a class="anchor" href="#NameHashing"></a><a class="link" href="#NameHashing">5.6. Hashed Module Names</a></h3>
<div class="paragraph">
<p>You can add <code>:module-hash-names true</code> to your build config to automatically create a MD5
signature for each generated output module file. That means that a <code>:main</code> module will generate
a <code>main.&lt;md5hash&gt;.js</code> instead of just the default <code>main.js</code>.</p>
</div>
<div class="paragraph">
<p>Such files can be cached forever since a file with different contents will have a different name.</p>
</div>
<div class="paragraph">
<p>However, this means that including these files in your HTML gets a bit more complicated.</p>
</div>
<div class="sect3">
<h4 id="_hashed_file_manifest"><a class="anchor" href="#_hashed_file_manifest"></a><a class="link" href="#_hashed_file_manifest">5.6.1. Hashed File Manifest</a></h4>
<div class="paragraph">
<p>When using hashed filenames <code>shadow-cljs</code> generates a <code>manifest.json</code> file in the configured <code>:output-dir</code>.
This file contains a JSON description of the module config together with an
extra "js-name" property which maps the original module name to the hashed name.</p>
</div>
<div class="listingblock">
<div class="title">Sample output of manifest.json when using hashed filenames.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">[{<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="error">:</span><span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">js-name</span><span class="delimiter">&quot;</span></span><span class="error">:</span><span class="string"><span class="delimiter">&quot;</span><span class="content">main.md5hash.js</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">depends-on</span><span class="delimiter">&quot;</span></span><span class="error">:</span>[], <span class="keyword">..</span><span class="keyword">.</span>}
 {<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="error">:</span><span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">js-name</span><span class="delimiter">&quot;</span></span><span class="error">:</span><span class="string"><span class="delimiter">&quot;</span><span class="content">extra.md5hash.js</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">depends-on</span><span class="delimiter">&quot;</span></span><span class="error">:</span>[<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>], <span class="keyword">..</span><span class="keyword">.</span>}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this file in your server to figure out which files to include.
Development builds also produce this file and you may check if for modifications to
know when a new build completed.</p>
</div>
<div class="paragraph">
<p>I use this file in production to know when a new CLJS release build should be loaded.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_targeting_node"><a class="anchor" href="#_targeting_node"></a><a class="link" href="#_targeting_node">6. Targeting Node</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is built-in support for generating code that is intended to be use as a stand-alone
script, and also for code that is intended to be used as a library. See the
section on <a href="#CommonConfig">common configuration</a> for the base settings needed in
a configuration file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The optimizations in node at the time of this writing default to <code>:simple</code>.
You can use the normal configuration options to set the <a href="#Optimization">optimization level</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_node_scripts"><a class="anchor" href="#_node_scripts"></a><a class="link" href="#_node_scripts">6.1. Node Scripts</a></h3>
<div class="paragraph">
<p>The <code>:target :node-script</code> produces single-file stand-alone output that can be run using <code>node.js</code>.
The code is just ClojureScript, and an entry point is easy to define:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.script</span>)

(<span class="keyword">defn</span> <span class="function">main</span> [&amp; cli-args]
  (<span class="keyword">prn</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_build_options"><a class="anchor" href="#_build_options"></a><a class="link" href="#_build_options">6.1.1. Build Options</a></h4>
<div class="paragraph">
<p>You will need the same basic <a href="#CommonConfig">main configuration</a> as in other targets (like
<code>:source-paths</code>), but you&#8217;ll need some node-specific build target options:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:main</code>
</td>
<td class="hdlist2">
<p>(required). The namespace-qualified symbol of your script&#8217;s entry point function.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-to</code>
</td>
<td class="hdlist2">
<p>(required). The path and filename for the generated script.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-dir</code>
</td>
<td class="hdlist2">
<p>(optional). The path for supporting files in development mode. Defaults to a cache directory.</p>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Sample node script build</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:script</span>
            {<span class="symbol">:id</span>        <span class="symbol">:script</span>
             <span class="symbol">:target</span>    <span class="symbol">:node-script</span>
             <span class="symbol">:main</span>      demo.script/main
             <span class="symbol">:output-to</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">out/demo-script/script.js</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When compiled this results in a standalone <code>out/demo-script/script.js</code> file intended to be called
via <code>node script.js &lt;command line args&gt;</code>. When run it will call <code>(demo.script/main &lt;command line args&gt;)</code>
function on startup. This only ever produces the file specified in <code>:output-to</code>. Any other support files
(e.g. for development mode) are written to a temporary support directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="NodeHotCodeReload"><a class="anchor" href="#NodeHotCodeReload"></a><a class="link" href="#NodeHotCodeReload">6.1.2. Hot Code Reload</a></h4>
<div class="paragraph">
<p>You will often write scripts that run as servers or some other long-running process. Hot code reload can
be quite useful when working with these, and it is simple to set up:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add start/top hook functions.</p>
</li>
<li>
<p>Configure the build use those hooks.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here is an example http server in node:</p>
</div>
<div class="listingblock">
<div class="title">Sample node script with start/stop hooks for hot code reload.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.script</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> http]))

(<span class="keyword">defn</span> <span class="function">request-handler</span> [req res]
  (<span class="keyword">.</span>end res <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))

<span class="comment">; a place to hang onto the server so we can stop/start it</span>
(<span class="keyword">defonce</span> <span class="function">server-ref</span>
  (volatile! <span class="predefined-constant">nil</span>))

(<span class="keyword">defn</span> <span class="function">main</span> [&amp; args]
  (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">starting server</span><span class="delimiter">&quot;</span></span>)
  (<span class="keyword">let</span> [server (http/createServer #(request-handler %1 %2))]

    (<span class="keyword">.</span>listen server <span class="integer">3000</span>
      (<span class="keyword">fn</span> [err]
        (<span class="keyword">if</span> err
          (js/console.error <span class="string"><span class="delimiter">&quot;</span><span class="content">server start failed</span><span class="delimiter">&quot;</span></span>)
          (js/console.info <span class="string"><span class="delimiter">&quot;</span><span class="content">http server running</span><span class="delimiter">&quot;</span></span>))
        ))

    (vreset! server-ref server)))

(<span class="keyword">defn</span> <span class="function">start</span>
  <span class="string"><span class="delimiter">&quot;</span><span class="content">Hook to start. Also used as a hook for hot code reload.</span><span class="delimiter">&quot;</span></span>
  []
  (js/console.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">start called</span><span class="delimiter">&quot;</span></span>)
  (main))

(<span class="keyword">defn</span> <span class="function">stop</span>
  <span class="string"><span class="delimiter">&quot;</span><span class="content">Hot code reload hook to shut down resources so hot code reload can work</span><span class="delimiter">&quot;</span></span>
  [done]
  (js/console.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">stop called</span><span class="delimiter">&quot;</span></span>)
  (when-some [srv @server-ref]
    (<span class="keyword">.</span>close srv
      (<span class="keyword">fn</span> [err]
        (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">stop completed</span><span class="delimiter">&quot;</span></span> err)
        (done)))))

(js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">__filename</span><span class="delimiter">&quot;</span></span> js/__filename)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The associated configuration is (<code>shadow-cljs.edn</code>):</p>
</div>
<div class="listingblock">
<div class="title">Adding hooks for hot core reload.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
   { <span class="symbol">:script</span> {<span class="keyword">..</span><span class="keyword">.</span> as before

              <span class="comment">; add in reload hooks</span>
              <span class="symbol">:devtools</span> {<span class="symbol">:before-load-async</span> demo.script/stop
                         <span class="symbol">:after-load</span> demo.script/start}}}}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Many libraries hide state or do actions that prevent hot code reloading from working well. There
is nothing the compiler can do to improve this since it has no idea what those libraries are doing.
Hot code reload will only work well in situations where you can cleanly "stop" and "restart" the
artifacts used.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="NodeLibrary"><a class="anchor" href="#NodeLibrary"></a><a class="link" href="#NodeLibrary">6.2. Node Libraries</a></h3>
<div class="paragraph">
<p>The <code>:target :node-library</code> emits code that can be used (via <code>require</code>) as a standard node library, and is
useful for publishing your code for re-use as a compiled Javascript artifact.</p>
</div>
<div class="paragraph">
<p>As with other modes the <a href="#CommonConfig">main configuration options</a> apply and must be set.
The target-specific options are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:target</code>
</td>
<td class="hdlist2">
<p>Use :node-library</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-to</code>
</td>
<td class="hdlist2">
<p>(required). The path and filename for the generated library.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:exports</code>
</td>
<td class="hdlist2">
<p>(required) Either a single namespace-qualified symbol or a map from keywords to namespace-qualified symbols.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-dir</code>
</td>
<td class="hdlist2">
<p>(optional). The path for supporting files in development mode. Defaults to a cache directory.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The hot code reload story is similar to <a href="#NodeHotCodeReload">the script target</a>, but may not work as well
since it cannot as easily control all of the code that is loaded.</p>
</div>
<div class="sect3">
<h4 id="_exports"><a class="anchor" href="#_exports"></a><a class="link" href="#_exports">6.2.1. Exports</a></h4>
<div class="paragraph">
<p>The <code>:exports</code> option deserves some specific examples. There are two possible ways to specify what should be exported:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Export a single artifact</p>
</li>
<li>
<p>Export any number of artifacts</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the first case, you can use a single symbol:</p>
</div>
<div class="listingblock">
<div class="title">Build configuration with a single export</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:lib</span> {<span class="symbol">:exports</span> demo.ns/f
                <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the resulting <code>require</code> in Node will give you <strong>that</strong> artifact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ node
&gt; var f = require('./lib.js');
f(); // the object I get is exactly what I exported</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the second case you supply a map from keyword names to artifacts:</p>
</div>
<div class="listingblock">
<div class="title">Build configuration with multiple exports</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:lib</span> {<span class="symbol">:exports</span> {<span class="symbol">:g</span>       demo.ns/f
                          <span class="symbol">:h</span>       other.ns/thing
                          <span class="symbol">:ns/ok?</span>  another.ns/ok?}
                <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The keyword is used as the name of the entry in the exported object. <strong>No munging is done</strong> to this keyword name
(but namespaces are dropped). So, the above example maps cljs <code>f</code> to <code>g</code>, etc.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ node
&gt; var lib = require('./lib.js');
lib.g(); // call demo-ns/f
lib[&quot;ok?&quot;](); // call another-ns/ok?</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The exports config automatically tracks exported symbols and passes them on to the optimization
stage. This means that anything listed in <code>:exports</code> will not be renamed by Google Closure optimizations.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_full_example"><a class="anchor" href="#_full_example"></a><a class="link" href="#_full_example">6.2.2. Full Example</a></h4>
<div class="paragraph">
<p>The example below creates a <code>lib.js</code> file intended to be consumed via the normal Node <code>require</code> mechanism.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.lib</span>)

(<span class="keyword">defn</span> <span class="function">hello</span> []
  (<span class="keyword">prn</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>)
  <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build configuration would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:library</span> {<span class="symbol">:target</span>    <span class="symbol">:node-library</span>
                    <span class="symbol">:output-to</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">out/demo-library/lib.js</span><span class="delimiter">&quot;</span></span>
                    <span class="symbol">:exports</span>   {<span class="symbol">:hello</span> demo.lib/hello}}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the runtime use is as you would expect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ cd out/demo-library
$ node
<span class="keyword">&gt;</span> <span class="keyword">var</span> x <span class="keyword">=</span> <span class="keyword">require</span>('<span class="keyword">.</span>/lib')<span class="comment">;</span>
undefined
<span class="keyword">&gt;</span> x.hello()
hello
'hello'</code></pre>
</div>
</div>
<div class="paragraph">
<p>As :node-script this will only create the file specified in :output-to. The :exports map maps CLJS vars
to the name they should be exported to.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Development mode has the <a href="#NodeModes">same setup</a> as for node scripts (extra dependencies).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_distributing_on_npm"><a class="anchor" href="#_distributing_on_npm"></a><a class="link" href="#_distributing_on_npm">6.3. Distributing on NPM</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing"><a class="anchor" href="#_testing"></a><a class="link" href="#_testing">7. Testing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>shadow-cljs</code> provides a few ultility targets to make building tests a little easier.</p>
</div>
<div class="sect2">
<h3 id="_browser_test"><a class="anchor" href="#_browser_test"></a><a class="link" href="#_browser_test">7.1. Browser Test</a></h3>
<div class="paragraph">
<p>This target is meant for gathering up namespaces that contain tests (based on a filename pattern match),
and triggering a test runner. It contains a built-in runner that will automatically scan for <code>cljs.test</code>
tests and run them.</p>
</div>
<div class="paragraph">
<p>The relevant configuration options are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:target</code>
</td>
<td class="hdlist2">
<p><code>:browser-test</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:test-dir</code>
</td>
<td class="hdlist2">
<p>A folder in which to output files. See below.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:ns-regexp</code>
</td>
<td class="hdlist2">
<p>(optional) A regular expression matching namespaces against project files. This only scans files, and
will not scan jars. Defaults to "-test$".</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:runner-ns</code>
</td>
<td class="hdlist2">
<p>(optional) A namespace that can contain a start, stop, and init function. Defaults to
<code>shadow.test.browser</code>.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The normal <code>:devtools</code> options are supported, so you will usually create an http server to serve the files.
In general you will need a config that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:test</span>     {<span class="symbol">:target</span>    <span class="symbol">:browser-test</span>
                     <span class="symbol">:test-dir</span>  <span class="string"><span class="delimiter">&quot;</span><span class="content">resources/public/js/test</span><span class="delimiter">&quot;</span></span>
                     <span class="symbol">:ns-regexp</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">-spec$</span><span class="delimiter">&quot;</span></span>
                     <span class="symbol">:runner-ns</span> tests.client-test-main
                     <span class="symbol">:devtools</span>  {<span class="symbol">:http-port</span>          <span class="integer">8021</span>
                                 <span class="symbol">:http-root</span>          <span class="string"><span class="delimiter">&quot;</span><span class="content">resources/public/js/test</span><span class="delimiter">&quot;</span></span>}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that the test directory will have the index.html, and a js folder.</p>
</div>
<div class="paragraph">
<p>If you choose to supply a test main, it might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">tests.client-test-main</span>)

(<span class="keyword">defn</span> <span class="function">start</span> []
  <span class="keyword">..</span><span class="keyword">.</span> run the tests.<span class="keyword">..</span>)

(<span class="keyword">defn</span> <span class="function">stop</span> [done]
  <span class="comment">; tests can be async. You must call done so that the runner knows you actually finished</span>
  (done))

(<span class="keyword">defn</span> ^<span class="symbol">:export</span> init []
  (start))</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_generated_output_in_code_test_dir_code"><a class="anchor" href="#_generated_output_in_code_test_dir_code"></a><a class="link" href="#_generated_output_in_code_test_dir_code">7.1.1. Generated output in <code>:test-dir</code></a></h4>
<div class="paragraph">
<p>The output includes two primary artifacts in your <code>test-dir</code> folder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>index.html</code> - If and only if there was not already an <code>index.html</code> file present. By default the generated
file loads the tests and runs <code>init</code> in the <code>:runner-ns</code>. You may edit or add a custom version that will
not be overwritten.</p>
</li>
<li>
<p><code>js/test.js</code> - The Javascript tests. The tests will always have this name. The entries for the module are
auto-generated.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_targeting_tests_to_karma_for_continuous_integration"><a class="anchor" href="#_targeting_tests_to_karma_for_continuous_integration"></a><a class="link" href="#_targeting_tests_to_karma_for_continuous_integration">7.2. Targeting Tests to Karma for Continuous Integration</a></h3>
<div class="paragraph">
<p>When you want to run your CLJS tests against a browser on some kind of CI server you&#8217;ll need to
be able to run the tests from a command line and get back a status code. Karma is a well-known
and supported test runner that can do this for you, and <code>shadow-cljs</code> includes a target that
can add the appropriate wrappers around your tests so the will work in it.</p>
</div>
<div class="sect3">
<h4 id="_installing_karma"><a class="anchor" href="#_installing_karma"></a><a class="link" href="#_installing_karma">7.2.1. Installing Karma</a></h4>
<div class="paragraph">
<p>See their <a href="http://karma-runner.github.io">website</a> for full instructions. You&#8217;ll typically need
something like this is your <code>package.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CITests</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Testing</span><span class="delimiter">&quot;</span></span>,
  <span class="error">.</span><span class="error">.</span><span class="error">.</span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">devDependencies</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">karma</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^2.0.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">karma-chrome-launcher</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^2.2.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">karma-cljs-test</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^0.1.0</span><span class="delimiter">&quot;</span></span>,
    <span class="error">.</span><span class="error">.</span><span class="error">.</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">license</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">MIT</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, you need Karma, a browser launcher, and the cljs-test integration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_build"><a class="anchor" href="#_the_build"></a><a class="link" href="#_the_build">7.2.2. The Build</a></h4>
<div class="paragraph">
<p>The build options are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:target</code>
</td>
<td class="hdlist2">
<p><code>:karma</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-to</code>
</td>
<td class="hdlist2">
<p>A path/filename for the js file.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:ns-regexp</code>
</td>
<td class="hdlist2">
<p>(optional) A regex to match the test namespaces.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So you might have something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> { <span class="symbol">:ci-tests</span> {<span class="symbol">:target</span>     <span class="symbol">:karma</span>
                      <span class="symbol">:js-options</span> {<span class="symbol">:js-provider</span> <span class="symbol">:shadow</span>} <span class="comment">; needed in older versions of shadow-cljs</span>
                      <span class="symbol">:output-to</span>  <span class="string"><span class="delimiter">&quot;</span><span class="content">target/ci.js</span><span class="delimiter">&quot;</span></span>
                      <span class="symbol">:ns-regexp</span>  <span class="string"><span class="delimiter">&quot;</span><span class="content">-spec$</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You also need a <code>karma.conf.js</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">m</span><span class="error">o</span><span class="error">d</span><span class="error">u</span><span class="error">l</span><span class="error">e</span><span class="error">.</span><span class="error">e</span><span class="error">x</span><span class="error">p</span><span class="error">o</span><span class="error">r</span><span class="error">t</span><span class="error">s</span> <span class="error">=</span> <span class="error">f</span><span class="error">u</span><span class="error">n</span><span class="error">c</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span> <span class="error">(</span><span class="error">c</span><span class="error">o</span><span class="error">n</span><span class="error">f</span><span class="error">i</span><span class="error">g</span><span class="error">)</span> {
    <span class="error">c</span><span class="error">o</span><span class="error">n</span><span class="error">f</span><span class="error">i</span><span class="error">g</span><span class="error">.</span><span class="error">s</span><span class="error">e</span><span class="error">t</span><span class="error">(</span>{
        <span class="error">b</span><span class="error">r</span><span class="error">o</span><span class="error">w</span><span class="error">s</span><span class="error">e</span><span class="error">r</span><span class="error">s</span>: [<span class="error">'</span><span class="error">C</span><span class="error">h</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">e</span><span class="error">H</span><span class="error">e</span><span class="error">a</span><span class="error">d</span><span class="error">l</span><span class="error">e</span><span class="error">s</span><span class="error">s</span><span class="error">'</span>],
        <span class="error">/</span><span class="error">/</span> <span class="error">T</span><span class="error">h</span><span class="error">e</span> <span class="error">d</span><span class="error">i</span><span class="error">r</span><span class="error">e</span><span class="error">c</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">y</span> <span class="error">w</span><span class="error">h</span><span class="error">e</span><span class="error">r</span><span class="error">e</span> <span class="error">t</span><span class="error">h</span><span class="error">e</span> <span class="error">o</span><span class="error">u</span><span class="error">t</span><span class="error">p</span><span class="error">u</span><span class="error">t</span> <span class="error">f</span><span class="error">i</span><span class="error">l</span><span class="error">e</span> <span class="error">l</span><span class="error">i</span><span class="error">v</span><span class="error">e</span><span class="error">s</span>
        <span class="error">b</span><span class="error">a</span><span class="error">s</span><span class="error">e</span><span class="error">P</span><span class="error">a</span><span class="error">t</span><span class="error">h</span>: <span class="error">'</span><span class="error">t</span><span class="error">a</span><span class="error">r</span><span class="error">g</span><span class="error">e</span><span class="error">t</span><span class="error">'</span>,
        <span class="error">/</span><span class="error">/</span> <span class="error">T</span><span class="error">h</span><span class="error">e</span> <span class="error">f</span><span class="error">i</span><span class="error">l</span><span class="error">e</span> <span class="error">i</span><span class="error">t</span><span class="error">s</span><span class="error">e</span><span class="error">l</span><span class="error">f</span>
        <span class="error">f</span><span class="error">i</span><span class="error">l</span><span class="error">e</span><span class="error">s</span>: [<span class="error">'</span><span class="error">c</span><span class="error">i</span><span class="error">.</span><span class="error">j</span><span class="error">s</span><span class="error">'</span>],
        <span class="error">f</span><span class="error">r</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">w</span><span class="error">o</span><span class="error">r</span><span class="error">k</span><span class="error">s</span>: [<span class="error">'</span><span class="error">c</span><span class="error">l</span><span class="error">j</span><span class="error">s</span><span class="error">-</span><span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">'</span>],
        <span class="error">p</span><span class="error">l</span><span class="error">u</span><span class="error">g</span><span class="error">i</span><span class="error">n</span><span class="error">s</span>: [<span class="error">'</span><span class="error">k</span><span class="error">a</span><span class="error">r</span><span class="error">m</span><span class="error">a</span><span class="error">-</span><span class="error">c</span><span class="error">l</span><span class="error">j</span><span class="error">s</span><span class="error">-</span><span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">'</span>, <span class="error">'</span><span class="error">k</span><span class="error">a</span><span class="error">r</span><span class="error">m</span><span class="error">a</span><span class="error">-</span><span class="error">c</span><span class="error">h</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">e</span><span class="error">-</span><span class="error">l</span><span class="error">a</span><span class="error">u</span><span class="error">n</span><span class="error">c</span><span class="error">h</span><span class="error">e</span><span class="error">r</span><span class="error">'</span>],
        <span class="error">c</span><span class="error">o</span><span class="error">l</span><span class="error">o</span><span class="error">r</span><span class="error">s</span>: <span class="value">true</span>,
        <span class="error">l</span><span class="error">o</span><span class="error">g</span><span class="error">L</span><span class="error">e</span><span class="error">v</span><span class="error">e</span><span class="error">l</span>: <span class="error">c</span><span class="error">o</span><span class="error">n</span><span class="error">f</span><span class="error">i</span><span class="error">g</span><span class="error">.</span><span class="error">L</span><span class="error">O</span><span class="error">G</span><span class="error">_</span><span class="error">I</span><span class="error">N</span><span class="error">F</span><span class="error">O</span>,
        <span class="error">c</span><span class="error">l</span><span class="error">i</span><span class="error">e</span><span class="error">n</span><span class="error">t</span>: {
            <span class="error">a</span><span class="error">r</span><span class="error">g</span><span class="error">s</span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">shadow.test.karma.init</span><span class="delimiter">&quot;</span></span>],
            <span class="error">s</span><span class="error">i</span><span class="error">n</span><span class="error">g</span><span class="error">l</span><span class="error">e</span><span class="error">R</span><span class="error">u</span><span class="error">n</span>: <span class="value">true</span>
        }
    }<span class="error">)</span>
}<span class="error">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>then you can run the tests as follows (assuming you&#8217;ve installed global executables of the tools):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs <span class="keyword">compile</span> ci
$ karma start --single-run
<span class="integer">12</span> <span class="integer">01</span> <span class="integer">2018</span> <span class="integer">01</span><span class="error">:</span><span class="integer">19</span><span class="error">:</span><span class="float">24.222</span><span class="symbol">:INFO</span> [karma]<span class="error">:</span> Karma v2.<span class="float">0.0</span> server started at http<span class="symbol">://0.</span><span class="float">0.0</span><span class="keyword">.</span><span class="integer">0</span><span class="error">:</span><span class="integer">9876</span><span class="keyword">/</span>
<span class="integer">12</span> <span class="integer">01</span> <span class="integer">2018</span> <span class="integer">01</span><span class="error">:</span><span class="integer">19</span><span class="error">:</span><span class="float">24.224</span><span class="symbol">:INFO</span> [launcher]<span class="error">:</span> Launching browser ChromeHeadless with unlimited concurrency
<span class="integer">12</span> <span class="integer">01</span> <span class="integer">2018</span> <span class="integer">01</span><span class="error">:</span><span class="integer">19</span><span class="error">:</span><span class="float">24.231</span><span class="symbol">:INFO</span> [launcher]<span class="error">:</span> Starting browser ChromeHeadless
<span class="integer">12</span> <span class="integer">01</span> <span class="integer">2018</span> <span class="integer">01</span><span class="error">:</span><span class="integer">19</span><span class="error">:</span><span class="float">24.478</span><span class="symbol">:INFO</span> [HeadlessChrome <span class="float">0.0</span><span class="keyword">.</span><span class="integer">0</span> (Mac OS X <span class="float">10.12</span><span class="keyword">.</span><span class="integer">6</span>)]<span class="error">:</span> Connected on socket TcfrjxVKmx7xN6enAAAA with id <span class="integer">85554456</span>
LOG<span class="error">:</span> 'Testing boo.sample-spec'
HeadlessChrome <span class="float">0.0</span><span class="keyword">.</span><span class="integer">0</span> (Mac OS X <span class="float">10.12</span><span class="keyword">.</span><span class="integer">6</span>)<span class="error">:</span> Executed <span class="integer">1</span> of <span class="integer">1</span> SUCCESS (<span class="float">0.007</span> secs <span class="keyword">/</span> <span class="float">0.002</span> secs)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_embedding_in_the_js_ecosystem_the_code_node_module_code_target"><a class="anchor" href="#_embedding_in_the_js_ecosystem_the_code_node_module_code_target"></a><a class="link" href="#_embedding_in_the_js_ecosystem_the_code_node_module_code_target">8. Embedding in the JS Ecosystem&#8201;&#8212;&#8201;The <code>:node-module</code> Target</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is an additional target that is intended to help you use <code>shadow-cljs</code> as <strong>part</strong> of
a project and provide seamless integration with existing JS tools (eg. webpack, browserify, babel,
create-react-app, &#8230;&#8203;) with as little configuration as possible.</p>
</div>
<div class="paragraph">
<p>It can be configured like other targets, but since it is meant to work in the JS ecosystem it
comes with a convenience mode that makes such integration easier.</p>
</div>
<div class="sect2">
<h3 id="_convenience_mode"><a class="anchor" href="#_convenience_mode"></a><a class="link" href="#_convenience_mode">8.1. Convenience Mode</a></h3>
<div class="paragraph">
<p>This target is meant to be as easy to access as possible, and does not actually require a specific
build in the config. You still need a non-empty config file, but the default one from
<code>shadow-cljs init</code> will do.</p>
</div>
<div class="paragraph">
<p>ClojureScript organizes files into namespaces which means that a <code>demo.foo</code> namespace should be inside a
<code>src/demo/foo.cljs</code> file. Where <code>src</code> is the default source path the shadow-cljs tool (see <a href="#CommonConfig">main configuration</a>).</p>
</div>
<div class="paragraph">
<p>If you have this file in <code>src/demo</code>:</p>
</div>
<div class="listingblock">
<div class="title">Sample source for <code>foo.cljs</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.foo</span>)

(<span class="keyword">defn</span> <span class="function">hello</span> [who]
  (<span class="keyword">str</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, </span><span class="delimiter">&quot;</span></span> who <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can compile it (and any others) via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs compile npm
[:npm] Build completed. (16 files, 5 compiled, 0 warnings, 7.91s)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated exports will be named <code>shadow-cljs/</code> with the CLJS namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="predefined">$</span> node
&gt; <span class="keyword">var</span> x = require(<span class="string"><span class="delimiter">&quot;</span><span class="content">shadow-cljs/demo.foo</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-constant">undefined</span>
&gt; x.hello(<span class="string"><span class="delimiter">&quot;</span><span class="content">JS</span><span class="delimiter">&quot;</span></span>)
<span class="string"><span class="delimiter">'</span><span class="content">Hello, JS!</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Watching with incremental compile is as simple as running <code>shadow-cljs watch npm</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_explicit_configuration"><a class="anchor" href="#_explicit_configuration"></a><a class="link" href="#_explicit_configuration">8.2. Explicit Configuration</a></h3>
<div class="paragraph">
<p>You can also treat <code>:npm-module</code> on the same footing with your other builds: give it explicit
configuration. This allows you to also customize the code generation options. Of course
you will configure the <a href="#CommonConfig">main configuration</a> as in all targets. The target-specific
options are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:target</code>
</td>
<td class="hdlist2">
<p>Use :node-module</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:entries</code>
</td>
<td class="hdlist2">
<p>(optinal) A vector of namespaces to include. Everything from these will be included.
Defaults to everything it can find.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-dir</code>
</td>
<td class="hdlist2">
<p>(optional). The path for supporting files in development mode. Defaults to
<code>node_modules/shadow-cljs</code>.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>:entries</code> setting can be used to limit what things get included, and the <code>:output-dir</code> is
particularly useful for naming the directory in <code>node_modules</code> so that you can
customize what name you use with <code>require</code>.</p>
</div>
<div class="paragraph">
<p>Each entry will still result in a file with that namespace name in the specified output directory.</p>
</div>
<div class="paragraph">
<p>Of course all of this is generated with standard Node conventions.</p>
</div>
<div class="paragraph">
<p>If you plan to distribute code on NPM, then you may want to use the
<a href="#NodeLibrary"><code>:node-library</code> target</a> instead since it allows for a finer level of control
over exports and optimization.</p>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_optimizations"><a class="anchor" href="#_working_with_optimizations"></a><a class="link" href="#_working_with_optimizations">8.3. Working with Optimizations</a></h3>
<div class="paragraph">
<p>Unlike the <code>:node-library</code> target, the module target does not know what you want to call the
symbols you&#8217;re exporting, so it just exports them as-is. If you use advanced compilation, then everything
will get a minified munged name!</p>
</div>
<div class="paragraph">
<p>This is easy to remedy, simply add <code>:export</code> metadata on any symbols that you want to preserve:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">def</span> ^<span class="symbol">:export</span> my-constant <span class="float">5.662</span>)
(<span class="keyword">defn</span> ^<span class="symbol">:export</span> my-function [] <span class="keyword">..</span><span class="keyword">.</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a standard annotation that is understood by ClojureScript and prevents Google Closure from
renaming an artifact.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generating_production_code_all_targets"><a class="anchor" href="#_generating_production_code_all_targets"></a><a class="link" href="#_generating_production_code_all_targets">9. Generating Production Code&#8201;&#8212;&#8201;All Targets</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Development mode always outputs individual files for each namespace so that they can be hot loaded
in isolation. When you&#8217;re ready to deploy code to a real server you want to run the Closure Compiler
on it to generate a single minified result for each <a href="#_modules">module</a>.</p>
</div>
<div class="paragraph">
<p>By default the release mode output file should just be a drop-in replacements for the
development mode file: there is no difference in the way you include them in your HTML. You
may use <a href="#NameHashing">filename hashing</a> to improve caching characteristics on browser targets.</p>
</div>
<div class="listingblock">
<div class="title">Generating Minified Output</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs release build-id</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="Optimization"><a class="anchor" href="#Optimization"></a><a class="link" href="#Optimization">9.1. Optimizations</a></h3>
<div class="paragraph">
<p>You can choose the optimization level using the <code>:compiler-options</code> section of the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:build</span>
   {<span class="symbol">:build-id</span>
     {<span class="keyword">..</span><span class="keyword">.</span>
      <span class="symbol">:compiler-options</span> {<span class="symbol">:optimizations</span> <span class="symbol">:whitespace</span>}}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://developers.google.com/closure/compiler/docs/compilation_levels">the Closure compiler&#8217;s documentation</a>
for more information on available optimization levels.</p>
</div>
</div>
<div class="sect2">
<h3 id="_release_specific_vs_development_configuration"><a class="anchor" href="#_release_specific_vs_development_configuration"></a><a class="link" href="#_release_specific_vs_development_configuration">9.2. Release-Specific vs. Development Configuration</a></h3>
<div class="paragraph">
<p>If you wish to have separate configuration values in a build when running a release build then you
can override settings by including a <code>:dev</code> and/or <code>:release</code> section in the build section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]
 <span class="symbol">:dependencies</span> []
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:asset-path</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/js</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:modules</span> {<span class="symbol">:base</span> {<span class="symbol">:entries</span> [my.app.core]}}

   <span class="comment">;; Here is some dev-specific config</span>
   <span class="symbol">:dev</span> {<span class="symbol">:compiler-options</span> {<span class="symbol">:devcards</span> <span class="predefined-constant">true</span>}}

   <span class="comment">;; Here is some production config</span>
   <span class="symbol">:release</span> {<span class="symbol">:compiler-options</span> {<span class="symbol">:optimizations</span> <span class="symbol">:whitespace</span>}}}}}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_targets"><a class="anchor" href="#_custom_targets"></a><a class="link" href="#_custom_targets">10. Custom Targets</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You might have guess that with so many targets the ecosystem probably allows easy extension.
Creating custom targets just requires one function. This function receives one argument (the compiler
state) and must return it after doing its work. This function is called once for each stage of the compilation.</p>
</div>
<div class="paragraph">
<p>The compiler provides three special keys from the <code>shadow.cljs.devtools.compiler</code> namespace:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>shadow.build/config</code>
</td>
<td class="hdlist2">
<p>The build config map from your <code>shadow-cljs.edn</code> file.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>shadow.build/mode</code>
</td>
<td class="hdlist2">
<p>Either <code>:dev</code> or <code>:release</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>shadow.build/stage</code>
</td>
<td class="hdlist2">
<p>A keyword. See below.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use it, you simply specify the fully qualified name of the function as the :target for your build.
In this case :target <code>build/custom</code>. The namespace is up to you.</p>
</div>
<div class="sect2">
<h3 id="_example"><a class="anchor" href="#_example"></a><a class="link" href="#_example">10.1. Example</a></h3>
<div class="paragraph">
<p>If your <code>:source-path</code> is <code>["src"]</code> then create a <code>src/build.clj</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">build</span>
  (<span class="symbol">:require</span> [shadow.build <span class="symbol">:as</span> build]
            [shadow.build.targets.browser <span class="symbol">:as</span> browser]))

(<span class="keyword">defn</span> <span class="function">custom</span> [{<span class="symbol">::build/keys</span> [stage mode config] <span class="symbol">:as</span> state}]
  (<span class="keyword">let</span> [state (browser/process state]
    (<span class="keyword">when</span> (<span class="keyword">and</span> (<span class="keyword">=</span> <span class="symbol">:flush</span> stage) (<span class="keyword">=</span> <span class="symbol">:dev</span> mode))
      (call-rsync)
    state))</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would call a call-rsync (undefined here, can do pretty much everything you want here) after every successful
dev build.</p>
</div>
<div class="paragraph">
<p>The state is a clojure map representing the full <code>shadow-build</code> compiler state.</p>
</div>
</div>
<div class="sect2">
<h3 id="_compilation_stages"><a class="anchor" href="#_compilation_stages"></a><a class="link" href="#_compilation_stages">10.2. Compilation Stages</a></h3>
<div class="paragraph">
<p>The stages are:</p>
</div>
<div class="paragraph">
<p><code>:init</code>
<code>:compile-prepare</code>
<code>:compile-finish</code>
<code>:optimize-prepare</code> (<code>:release</code> only)
<code>:optimize-finish</code> (<code>:release</code> only)
<code>:flush</code></p>
</div>
<div class="paragraph">
<p>When mode is <code>:dev</code> the <code>:init</code> is only called once. Any of the others may be called
again (in order) when autobuild is active and files are re-compiled on change.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_editor_ide_repl_setup"><a class="anchor" href="#_editor_ide_repl_setup"></a><a class="link" href="#_editor_ide_repl_setup">11. Editor/IDE/REPL Setup</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_repl"><a class="anchor" href="#_repl"></a><a class="link" href="#_repl">11.1. REPL</a></h3>
<div class="paragraph">
<p>You can use the command-line utility to connect to a REPL simply by using a running build ID:</p>
</div>
<div class="listingblock">
<div class="title">Browser REPL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">shadow-cljs cljs-repl app</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Node REPL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">shadow-cljs node-repl</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cursive"><a class="anchor" href="#_cursive"></a><a class="link" href="#_cursive">11.2. Cursive</a></h3>
<div class="paragraph">
<p>If you&#8217;re a Cursive user then you currently need at least a dummy <code>project.clj</code> file. You may also wish to
read the</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(defproject your/project <span class="string"><span class="delimiter">&quot;</span><span class="content">0.0.0</span><span class="delimiter">&quot;</span></span>
  <span class="symbol">:dependencies</span>
  [[thheller/shadow-cljs <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.20170629</span><span class="delimiter">&quot;</span></span>]]

  <span class="symbol">:source-paths</span>
  [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will allow Cursive to detect the proper source paths for the project.</p>
</div>
<div class="paragraph">
<p>If you want the full Cursive experience including proper code navigation then you want to use full
<a href="#Leiningen">Leiningen integration</a>.</p>
</div>
<div class="sect3">
<h4 id="_cursive_repl_integration"><a class="anchor" href="#_cursive_repl_integration"></a><a class="link" href="#_cursive_repl_integration">11.2.1. Cursive REPL Integration</a></h4>
<div class="paragraph">
<p>An <a href="#nREPL">nREPL</a> is created by <code>shadow-cljs</code> when it is in development mode. You can connect to it to get
REPL integration using a Clojure Remote REPL run configuration.</p>
</div>
<div class="paragraph">
<p>By default the network port number is random, but that will be a major pain. You have
two choices:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the nREPL port</p>
</li>
<li>
<p>Use a symlink to get the port into the standard location.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Option 1 is nice because it doesn&#8217;t require any filesystem interactions:</p>
</div>
<div class="listingblock">
<div class="title">NREPL in shadow-cljs.edn</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:nrepl</span> {<span class="symbol">:port</span> <span class="integer">9000</span>}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Option 2 is simple, but involves using the standard nREPL port file, which you may need for other
network REPLs like your server. The port for the <code>shadow-cljs</code> REPL is written out to
<code>target/shadow-cljs/nrepl.port</code>, so simply symbolically link this file to the standard
<code>~/.nrepl-port</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using a symbolic link for REPL port</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">ln -sv target/shadow-cljs/nrepl.port <span class="keyword">.</span>nrepl-port</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you&#8217;ve chosen your option for tracking the port, you can add a run configuration via
<code>Run &#8594; Edit Configurations&#8230;&#8203;</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/cursive-repl-1.png" alt="cursive repl 1">
</div>
<div class="title">Figure 1. Clicking on the <code>+</code> icon will add a new run configuration.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/cursive-repl-2.png" alt="cursive repl 2">
</div>
<div class="title">Figure 2. Choose a Clojure Remote REPL</div>
</div>
<div class="paragraph">
<p>In the last step either type in the port you&#8217;ve set in your config, or choose to use the
standard nrepl port:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/cursive-repl-3.png" alt="cursive repl 3">
</div>
<div class="title">Figure 3. If you&#8217;re using <code>.nrepl-port</code>, then configure as shown. If you configured the port number in <code>shadow-cljs.edn</code> then use <code>localhost</code> and the configured port number.</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cider"><a class="anchor" href="#_cider"></a><a class="link" href="#_cider">11.3. CIDER</a></h3>
<div class="paragraph">
<p>CIDER support requires the simple combination of having the <code>cider-nrepl</code> dependency on your
classpath and configuring nREPL. The entries to <code>shadow-cljs.edn</code> are simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span> [[cider/cider-nrepl <span class="string"><span class="delimiter">&quot;</span><span class="content">0.16.0</span><span class="delimiter">&quot;</span></span>]]
 <span class="symbol">:nrepl</span> {<span class="symbol">:port</span> <span class="integer">8202</span>}

 <span class="keyword">..</span><span class="keyword">.</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>then invoke the <code>cider-connect</code> function from emacs.</p>
</div>
<div class="paragraph">
<p>When you connect to the nREPL it will start out in CLJ mode. If you select a running build it should
switch the nREPL session to CLJS.</p>
</div>
<div class="paragraph">
<p>Internally, it does this either by calling a fake piggieback function or the "official" API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(cemerick.piggieback/cljs-repl <span class="symbol">:id-of-build</span>)
<span class="comment">;; or</span>
(shadow.cljs.devtools.api/nrepl-select <span class="symbol">:id-of-build</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once connected you should be able to eval code using <code>C-c C-c</code> (eval a block), <code>C-x C-e</code> (eval sexp),
or <code>C-c C-k</code> (eval buffer).</p>
</div>
<div class="paragraph">
<p>If you see an error like "`cider-load-buffer' needs a ClojureScript REPL", you need to hit
enter once in the repl buffer. Emacs should then recognize that you have a cljs repl buffer and
evals should start working.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>shadow-cljs</code> will automatically add the required <code>cider-nrepl</code> middleware when it finds <code>cider.nrepl</code>
on your classpath, i.e. in your dependencies.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_to_do_when_things_don_t_work"><a class="anchor" href="#_what_to_do_when_things_don_t_work"></a><a class="link" href="#_what_to_do_when_things_don_t_work">12. What to do when things don’t work?</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since the JS world is still evolving rapidly and not everyone is using the same way to write and
distribute code there are some things <code>shadow-cljs</code> cannot work around automatically. These
can usually be solved with custom <code>:resolve</code> configs, but there may also be bugs or oversights.</p>
</div>
<div class="paragraph">
<p>If you cannot resolve such an issue with the instructions in this chapter, then try asking on the
<a href="https://clojurians.slack.com/messages/C6N245JGG"><code>#shadow-cljs</code> Slack channel</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hacking"><a class="anchor" href="#_hacking"></a><a class="link" href="#_hacking">13. Hacking</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_patching_libraries"><a class="anchor" href="#_patching_libraries"></a><a class="link" href="#_patching_libraries">13.1. Patching Libraries</a></h3>
<div class="paragraph">
<p>The shadow-cljs compiler ensure that things on your source paths are
compiled last. Things from JAR files go first. This means that
you can copy a source file from a library, patch it, and include it
in your own source directory. This is a convenient way to test out
fixes (even to <code>shadow-cljs</code> itself!) without having to clone
that project and understand its setup, build, etc.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2018-01-12 14:04:57 CET
</div>
</div>
</body>
</html>